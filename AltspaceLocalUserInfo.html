<html>
<body>

<style>
#localUserElem
{
	display: block;
	border: 3px solid blue;
	color: #fff;
	font-weight: bold;
	padding: 20px;
}

#localUserElem .userValue
{
	display: inline;
	color: #ffff00;
}
</style>

<div style="font-size: 30px; color: #fff;">Local User Info</div>

<div id="localUserElem">
	isWebUser: <div class="userValue isWebUser"></div><br />
	userId: <div class="userValue userId"></div><br />
	isLocal: <div class="userValue isLocal"></div><br />
	displayName: <div class="userValue displayName"></div><br />
	headPosition: <div class="userValue headPosition"></div><br />
	headLook: <div class="userValue headLook"></div><br />
	hasLeftHand: <div class="userValue hasLeftHand"></div><br />
	hasRightHand: <div class="userValue hasRightHand"></div><br />
	leftHandCenter: <div class="userValue leftHandCenter"></div><br />
	leftHandCenterLocal: <div class="userValue leftHandCenterLocal"></div><br />
	leftHandDirection: <div class="userValue leftHandDirection"></div><br />
	leftHandDirectionLocal: <div class="userValue leftHandDirectionLocal"></div><br />
	leftHandOrientation: <div class="userValue leftHandOrientation"></div><br />
	leftHandOrientationLocal: <div class="userValue leftHandOrientationLocal"></div><br />
	rightHandCenter: <div class="userValue rightHandCenter"></div><br />
	rightHandCenterLocal: <div class="userValue rightHandCenterLocal"></div><br />
	rightHandDirection: <div class="userValue rightHandDirection"></div><br />
	rightHandDirectionLocal: <div class="userValue rightHandDirectionLocal"></div><br />
	rightHandOrientation: <div class="userValue rightHandOrientation"></div><br />
	rightHandOrientationLocal: <div class="userValue rightHandOrientationLocal"></div><br />
</div>

<script>
	// Global object for the local user to be filled out by the Altspace callback.
	var gLocalUser = {
		isWebUser: true,
		userId: 0,
		isLocal: true,
		displayName: "Web User",
		headPosition: [0, 0, 0],
		headLook: [0, 0, 0],
		hasLeftHand: false,
		hasRightHand: false,
		leftHandCenter: [0, 0, 0],
		leftHandCenterLocal: [0, 0, 0],
		leftHandDirection: [0, 0, 0],
		leftHandDirectionLocal: [0, 0, 0],
		leftHandOrientation: [0, 0, 0],
		leftHandOrientationLocal: [0, 0, 0],
		rightHandCenter: [0, 0, 0],
		rightHandCenterLocal: [0, 0, 0],
		rightHandDirection: [0, 0, 0],
		rightHandDirectionLocal: [0, 0, 0],
		rightHandOrientation: [0, 0, 0],
		rightHandOrientationLocal: [0, 0, 0]
	};	

	// Global object for ALL users in the current space.
	var gUsers = new Array();

	// Grab the DOM elements we will be outputting debug information to.
	var gLocalUserElem = document.getElementById("localUserElem");

	// If we're in Altspace, wait for our AltContentLoaded callback, otherwise, just wait until the DOM is loaded.
	if( typeof window.Alt !== 'undefined' )
	{
		window.addEventListener("AltContentLoaded", DocumentReady);

		// Also register callbacks to listen for users entering/leaving the space.
		//window.addEventListener("AltUserEnter", OnUserEnter);
		//window.addEventListener("AltUserLeave", OnUserLeave);
	}
	else
		window.addEventListener("load", DocumentReady);


	function DocumentReady()
	{
		UpdateLocalUserInfo();
	}


	function LocalUserReady()
	{
		g_LocalUserInfoUpdateHandle = setInterval(UpdateLocalUserInfo, 50);

/*
		// Now tha
		var altspaceUsers = window.Alt.Users.getUsers();
		altspaceUsers.then(function(users)
		{
			var i;
			for( i = 0; i < users.length; i++ )
			{
				var x;
				for( x in users[i] )
					document.write("<font style='color: #fff;'>" + x + ":<br />" + users[i][x] + "</font><br /><br />");
			}
		});
*/
	}

	function DrawLocalUserDebugInfo()
	{
		// Display all of the info about the current user into the debug element.
		var propertyElem;
		var x;
		for( x in gLocalUser )
		{
			propertyElem = gLocalUserElem.getElementsByClassName(x)[0];	// Assume every property has a matching debug out put element.

			while( propertyElem.childNodes.length > 0 )
				propertyElem.removeChild(propertyElem.lastChild);

			propertyElem.appendChild(document.createTextNode(gLocalUser[x]));
		}
	}

	var g_LocalUserInfoUpdateHandle = null;
	var g_bLocalUserInfoUpdateInProgress = false;
	function UpdateLocalUserInfo()
	{
		if( g_bLocalUserInfoUpdateInProgress )
			return;

		g_bLocalUserInfoUpdateInProgress = true;

		if( typeof window.Alt !== 'undefined' )
		{
			var localAltspaceUser = window.Alt.Users.getLocalUser();

			// We cannot access the properties of the user directly, instead, we must use a callback in the "then" method.
			// This is likely because Altspace grabs the most recent user information from the back-end every time.
			localAltspaceUser.then(function(user)
			{
				// We're only getting the display name every time in case they are able to change their name during gameplay
				gLocalUser.userId = user.userId;
				gLocalUser.isLocal = user.isLocal;
				gLocalUser.displayName = user.displayName;
				gLocalUser.isWebUser = false;

				window.Alt.Input.GetLookRay(function(ray)
				{
					gLocalUser.headLook = ray.Direction;
					gLocalUser.headPosition = ray.Origin;

					window.Alt.Input.GetSkeletonFrame(function(frame)
					{
						var x;
						for( x in frame )
						{
							if( typeof gLocalUser[x] !== 'undefined' )
								gLocalUser[x] = frame[x];
						}

						DrawLocalUserDebugInfo();

						g_bLocalUserInfoUpdateInProgress = false;

						if( !g_LocalUserInfoUpdateHandle )
							LocalUserReady();
					});
				});
			});

			// Note that the Altspace user object's "then" method takes 2 callback functions as parameters.  The 2nd parameter
			// is optional but would be the one fired if this back-end request was denied by Altspace.
		}
		else
		{
			DrawLocalUserDebugInfo();

			if( !g_LocalUserInfoUpdateHandle )
				LocalUserReady();

			g_bLocalUserInfoUpdateInProgress = false;
		}
	}
</script>

</body>
</html>